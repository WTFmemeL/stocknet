
=== StockNet v9 — CNN+WaveNet fusion, anti-leak strict ===
✅ Feature 'vol_price_ratio' calculée (ratio volume/prix).
✅ Feature 'ctx_div_cvd_uptrend' calculée (divergence CVD-prix en tendance haussière).
✅ Feature 'ctx_div_rsi_downtrend' calculée (divergence RSI-prix en tendance baissière).
✅ Feature 'ctx_div_cvd_lowvol' calculée (divergence CVD-volume pondérée).
✅ Feature 'ctx_div_rsi_lowvol' calculée (divergence RSI-volume pondérée).
✅ Données : 392,900 lignes
✅ Colonne cvd_state générée avant feature shifting.
✅ cvd_state encodé numériquement.
⏱️ Split strict: train=294674, test=78581, gap=19644
✅ Fenêtrage: X_train=(2946, 100, 20), X_test=(589, 100, 20)
⚙️ Entraînement StockNetCNN+WaveNet (3-classes)...
Epoch 1/30
 1/93 [..............................] - ETA: 26s - loss: 1.1302 - accuracy: 0.250034/93 [=========>....................] - ETA: 0s - loss: 0.8220 - accuracy: 0.5046 70/93 [=====================>........] - ETA: 0s - loss: 0.8049 - accuracy: 0.500493/93 [==============================] - 1s 3ms/step - loss: 0.8021 - accuracy: 0.4952 - val_loss: 0.8313 - val_accuracy: 0.5096 - lr: 0.0010
Epoch 2/30
 1/93 [..............................] - ETA: 0s - loss: 0.9513 - accuracy: 0.500036/93 [==========>...................] - ETA: 0s - loss: 0.7988 - accuracy: 0.506173/93 [======================>.......] - ETA: 0s - loss: 0.7796 - accuracy: 0.500093/93 [==============================] - 0s 2ms/step - loss: 0.7738 - accuracy: 0.5051 - val_loss: 0.8282 - val_accuracy: 0.4917 - lr: 0.0010
Epoch 3/30
 1/93 [..............................] - ETA: 0s - loss: 0.7898 - accuracy: 0.531238/93 [===========>..................] - ETA: 0s - loss: 0.7544 - accuracy: 0.518975/93 [=======================>......] - ETA: 0s - loss: 0.7694 - accuracy: 0.506793/93 [==============================] - 0s 2ms/step - loss: 0.7724 - accuracy: 0.4976 - val_loss: 0.8233 - val_accuracy: 0.4955 - lr: 0.0010
Epoch 4/30
 1/93 [..............................] - ETA: 0s - loss: 0.7919 - accuracy: 0.593834/93 [=========>....................] - ETA: 0s - loss: 0.7808 - accuracy: 0.490872/93 [======================>.......] - ETA: 0s - loss: 0.7647 - accuracy: 0.502293/93 [==============================] - 0s 2ms/step - loss: 0.7683 - accuracy: 0.4973 - val_loss: 0.8179 - val_accuracy: 0.4930 - lr: 0.0010
Epoch 5/30
 1/93 [..............................] - ETA: 0s - loss: 0.8353 - accuracy: 0.468839/93 [===========>..................] - ETA: 0s - loss: 0.7546 - accuracy: 0.513677/93 [=======================>......] - ETA: 0s - loss: 0.7624 - accuracy: 0.499693/93 [==============================] - 0s 2ms/step - loss: 0.7672 - accuracy: 0.5051 - val_loss: 0.8178 - val_accuracy: 0.4955 - lr: 0.0010
Epoch 6/30
 1/93 [..............................] - ETA: 0s - loss: 0.7194 - accuracy: 0.562538/93 [===========>..................] - ETA: 0s - loss: 0.7653 - accuracy: 0.507476/93 [=======================>......] - ETA: 0s - loss: 0.7624 - accuracy: 0.514893/93 [==============================] - 0s 2ms/step - loss: 0.7647 - accuracy: 0.5143 - val_loss: 0.8196 - val_accuracy: 0.4994 - lr: 0.0010
Epoch 7/30
 1/93 [..............................] - ETA: 0s - loss: 0.7301 - accuracy: 0.468839/93 [===========>..................] - ETA: 0s - loss: 0.7632 - accuracy: 0.520877/93 [=======================>......] - ETA: 0s - loss: 0.7585 - accuracy: 0.515893/93 [==============================] - 0s 2ms/step - loss: 0.7614 - accuracy: 0.5146 - val_loss: 0.8126 - val_accuracy: 0.5083 - lr: 0.0010
Epoch 8/30
 1/93 [..............................] - ETA: 0s - loss: 0.6890 - accuracy: 0.656239/93 [===========>..................] - ETA: 0s - loss: 0.7524 - accuracy: 0.530477/93 [=======================>......] - ETA: 0s - loss: 0.7608 - accuracy: 0.523193/93 [==============================] - 0s 2ms/step - loss: 0.7630 - accuracy: 0.5197 - val_loss: 0.8254 - val_accuracy: 0.4548 - lr: 0.0010
Epoch 9/30
 1/93 [..............................] - ETA: 0s - loss: 0.7937 - accuracy: 0.437539/93 [===========>..................] - ETA: 0s - loss: 0.7612 - accuracy: 0.534577/93 [=======================>......] - ETA: 0s - loss: 0.7637 - accuracy: 0.525693/93 [==============================] - 0s 2ms/step - loss: 0.7599 - accuracy: 0.5285 - val_loss: 0.8226 - val_accuracy: 0.5197 - lr: 0.0010
Epoch 10/30
 1/93 [..............................] - ETA: 0s - loss: 0.7044 - accuracy: 0.593838/93 [===========>..................] - ETA: 0s - loss: 0.7754 - accuracy: 0.503377/93 [=======================>......] - ETA: 0s - loss: 0.7715 - accuracy: 0.489493/93 [==============================] - 0s 2ms/step - loss: 0.7668 - accuracy: 0.4942 - val_loss: 0.8188 - val_accuracy: 0.5032 - lr: 0.0010
Epoch 11/30
 1/93 [..............................] - ETA: 0s - loss: 0.7716 - accuracy: 0.500038/93 [===========>..................] - ETA: 0s - loss: 0.7396 - accuracy: 0.541976/93 [=======================>......] - ETA: 0s - loss: 0.7519 - accuracy: 0.542493/93 [==============================] - 0s 2ms/step - loss: 0.7519 - accuracy: 0.5411 - val_loss: 0.8215 - val_accuracy: 0.5083 - lr: 5.0000e-04
Epoch 12/30
 1/93 [..............................] - ETA: 0s - loss: 0.6806 - accuracy: 0.718839/93 [===========>..................] - ETA: 0s - loss: 0.7520 - accuracy: 0.544977/93 [=======================>......] - ETA: 0s - loss: 0.7536 - accuracy: 0.543493/93 [==============================] - 0s 2ms/step - loss: 0.7528 - accuracy: 0.5401 - val_loss: 0.8180 - val_accuracy: 0.5096 - lr: 5.0000e-04
 1/25 [>.............................] - ETA: 0s - loss: 0.8526 - accuracy: 0.531225/25 [==============================] - 0s 803us/step - loss: 0.8126 - accuracy: 0.5083

📊 Accuracy=0.508
💾 Modèle sauvegardé : model_v9_last.keras

📈 Génération des prédictions et rapport de test...
 1/25 [>.............................] - ETA: 0s25/25 [==============================] - 0s 810us/step
💾 Résultats enregistrés : /home/jx/Documents/stocknet/out/preds_v9.csv

📊 Rapport de classification :
              precision    recall  f1-score   support

           0      0.457     0.256     0.328       351
           1      0.000     0.000     0.000        36
           2      0.526     0.776     0.627       398

    accuracy                          0.508       785
   macro avg      0.327     0.344     0.318       785
weighted avg      0.471     0.508     0.465       785


🧩 Matrice de confusion :
[[ 90   0 261]
 [ 18   0  18]
 [ 89   0 309]]
